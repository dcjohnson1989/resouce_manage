{% extends "layout.html" %}
{% block body %}
  {% if session.logged_in %}
  <script type="text/javascript">
	function test(x){
		var price = x.options[x.options.selectedIndex].getAttribute('price'); 
		var index = x.parentNode.parentNode.rowIndex;
		var quantity = document.getElementsByName("quantity")[index-1].value;
		var total_price = (parseFloat(price) * parseInt(quantity)).toFixed(2);
		document.getElementsByName("total_price")[index-1].innerHTML = total_price;
	}
	function add_row(){
		var table = document.getElementById("recipe");
		var rowCount = table.rows.length;
		var row = table.insertRow(rowCount);
		var cell1 = row.insertCell(0);
		cell1.innerHTML="<select name = \"resource_list\" onchange=\"test(this)\">{% for item in resource_list %}<option value=\"{{ item.id }}\" price=\"{{ item.price }}\">{{ item.id }} {{ item.brand }} {{ item.name }}</option>{% endfor %}</select>";
		var cell2 = row.insertCell(1);
		cell2.innerHTML="<input type=text size=10 name=\"quantity\">"
		var cell3 = row.insertCell(2);
		cell3.innerHTML="<p name=\"total_price\"></p>"
	}
	</script>
	<button id='add' onclick="add_row()">Add</button>
	<form action="{{ url_for('add_recipe') }}" method=post class=add-entry>
	<h2>甜品：</h2>
	<input type=text size=20 name="dessert">
	<table id="recipe">
	<tr>
		<th>原料</th>
		<th>数量</th>
		<th>总价</th>
	</tr>
	<tr>
		<td>
			<select name = "resource_list" onchange="test(this)">
				{% for item in resource_list %}
					<option value="{{ item.id }}" price="{{ item.price }}">{{ item.id }} {{ item.brand }} {{ item.name }}</option>
				{% endfor %}
			</select>
		</td>
		<td>
			<input type=text size=10 name="quantity">
		</td>
		<td>
			<p name="total_price"></p>
		</td>
	</tr>
	<!-- <input type=submit onclick="test()"> -->
	</table>
	<input type=submit value="submit">
	</form>
  {% endif %}
{% endblock %}